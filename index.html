<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base href="https://cdn.jsdelivr.net/gh/bubbls/UGS-Assets@main/gardenless/">
  <title>PvZ2 Gardendless Online | 0.6.0</title>
  
  <style>
    body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #000; overflow: hidden; }
    #GameDiv { width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; }
    #Cocos3dGameContainer { width: 100%; height: 100%; position: relative; }
    canvas { 
      position: absolute; 
      top: 0; left: 0; 
      width: 100% !important; 
      height: 100% !important; 
      z-index: 1; 
    }
  </style>

  <script>
    (function() {
      // 1. WebGL & Memory Fix
      const originalGetContext = HTMLCanvasElement.prototype.getContext;
      HTMLCanvasElement.prototype.getContext = function(type, attributes) {
        if (type === 'webgl' || type === 'webgl2') {
          attributes = Object.assign({}, attributes, {
            alpha: true,
            depth: true,
            stencil: true,
            antialias: false,
            premultipliedAlpha: true,
            preserveDrawingBuffer: true, // Needed for some ChromeOS GPUs to see the UI layer
            powerPreference: "high-performance"
          });
        }
        return originalGetContext.call(this, type, attributes);
      };

      // 2. Asset loading fix
      const originalImage = window.Image;
      window.Image = function() {
        const img = new originalImage();
        img.crossOrigin = 'anonymous';
        return img;
      };
    })();
  </script>

  <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1,minimal-ui=true" />
  <link rel="stylesheet" type="text/css" href="style.f76d1.css" />
</head>

<body>
  <div id="GameDiv">
    <div id="Cocos3dGameContainer">
      <canvas id="GameCanvas" oncontextmenu="event.preventDefault()" tabindex="99"></canvas>
    </div>
  </div>

  <script src="src/polyfills.bundle.5adbf.js" charset="utf-8"></script>
  <script src="src/system.bundle.543e6.js" charset="utf-8"></script>
  <script src="src/import-map.4399c.json" type="systemjs-importmap" charset="utf-8"></script>

  <script>
    (function() {
      // 3. UI ENFORCEMENT SCRIPT
      // This runs every 1 second to find the UI Layer and force it to show up
      const forceUIUpdate = () => {
        if (window.cc && cc.director) {
          const scene = cc.director.getScene();
          if (scene) {
            // Find all nodes that might be UI (Canvas, UI_Root, etc.)
            const children = scene.getComponentsInChildren(cc.Canvas);
            children.forEach(canvas => {
              canvas.node.active = true;
              canvas.node.opacity = 255;
            });
          }
        }
      };

      // 4. Engine Tick & Resize Fix
      const fixLayout = () => {
        window.dispatchEvent(new Event('resize'));
        const canvas = document.getElementById('GameCanvas');
        if (canvas) {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        }
      };

      // Run background checks every 1000ms
      setInterval(() => {
        forceUIUpdate();
        if (window.cc && cc.director && cc.director.isPaused()) {
            cc.director.resume();
        }
      }, 1000);

      window.addEventListener('load', () => {
        System.import('./index.bed7f.js').then(() => {
          console.log("Game Loaded - Monitoring UI Layers...");
          setTimeout(fixLayout, 2000);
        }).catch(err => console.error("System Import Error:", err));
      });

      // ChromeOS Touch/Click Fix: Sometimes UI only appears after first interaction
      window.addEventListener('mousedown', fixLayout, { once: true });
    })();
  </script>
</body>
</html>
